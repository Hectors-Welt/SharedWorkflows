name: Check for branch and tags

on:
  workflow_call:
        
jobs:
  check_branch_and_tag:
    runs-on: ubuntu-latest
    steps:
      - name: Extract branch name
        id: branch_name
        run: |
          echo ${GITHUB_REF##*/}
          echo BRANCH_NAME=${GITHUB_REF##*/} >> $GITHUB_OUTPUT
      
      - name: Check for branch
        if: startsWith(github.ref, 'refs/tags/staging-') steps.branch_name.outputs.BRANCH_NAME == 'develop'
        id: branch
        run: |
          echo "STATUS=success" >> $GITHUB_OUTPUT

      - name: Check for conditioning tag
        id: conditioning_tag
        if: steps.branch.outputs.STATUS == 'success'
        run: |
          echo LATEST_PRERELEASE_VERSION=git tag --list 'prerelease-*'   |git tag  --sort=taggerdate | tail -1 | cut -d '-' -f 2 >> $GITHUB_OUTPUT
          echo STAGING_VERSION=$(echo ${GITHUB_REF/refs\/tags\/staging-/}) >> $GITHUB_OUTPUT

      - name: Check versions
        if: steps.branch.outputs.STATUS == 'success' && steps.conditioning_tag.outputs.LATEST_PRERELEASE_VERSION == steps.conditioning_tag.outputs.STAGING_VERSION
        run: |
          echo SUCCESS
